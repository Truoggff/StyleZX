@model StyleZX.Controllers.ProductController.ProductDetailViewModel

@{
    ViewBag.Title = "Chi Tiết Sản Phẩm";

    var allImages = new List<string> { Model.ImageUrl };
    if (Model.RelatedImages != null && Model.RelatedImages.Any())
    {
        allImages.AddRange(Model.RelatedImages);
    }
}
<style>
    .product-detail-container {
        display: flex;
        padding: 30px;
        gap: 70px;
        background-color: aliceblue;
        font-family: 'Montserrat', sans-serif;
    }

    .thumbnail-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-right: 5px;
    }

        .thumbnail-list img {
            width: 100px;
            border: 2px solid transparent;
            border: 1px solid black;
            cursor: pointer;
            border-radius: 8px;
            margin-top: 2px;
        }

            .thumbnail-list img:hover, img:active {
                border-color: #007bff;
            }

    .product-image {
        text-align: center;
        border-radius: 8px;
        padding: 2px;
        background-color: aliceblue;
    }

    .product-img {
        max-width: 100%;
        max-height: 400px;
        object-fit: contain;
        border-radius: 8px;
        align-items: center;
        justify-content: center;
        border: 2px solid black;
    }

    .product-info {
        max-width: 700px;
        margin-right: 50px;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0px 0px 2px 4px rgba(0, 0, 0, 0.1);
        background-color: antiquewhite;
    }

    .quantity-minus {
        width: 30px;
        height: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f0f0f0; /* Màu nền mặc định */
        border: 1px solid #ccc;
        color: #333; /* Màu biểu tượng */
        transition: background-color 0.3s, color 0.3s;
    }

        .quantity-minus:hover {
            background-color: #007bff; /* Màu nền khi hover */
            color: white; /* Màu biểu tượng khi hover */
            border-color: #007bff;
        }

        .quantity-minus i {
            font-size: 14px;
            pointer-events: none; /* Tránh bị click vào riêng icon */
        }

    .quantity-plus {
        width: 30px;
        height: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        color: #333;
        transition: background-color 0.3s, color 0.3s;
    }

        .quantity-plus:hover {
            background-color: #007bff; /* Màu nền khi hover */
            color: white; /* Màu biểu tượng khi hover */
            border-color: #007bff;
        }

        .quantity-plus i {
            font-size: 14px;
            pointer-events: none; /* Tránh bị click vào riêng icon */
        }


    .btn-add-to-cart {
        background-color: lightseagreen;
        color: white;
        border: none;
        transition: background-color 0.3s ease;
    }

        .btn-add-to-cart:hover {
            background-color: aqua; /* Darker green */
        }

    .btn-order-now {
        background-color: crimson;
        color: white;
        border: none;
        transition: background-color 0.3s ease;
    }

        .btn-order-now:hover {
            background-color: coral; /* Darker red */
        }
    .btn-continue:hover {
        background-color:aquamarine;
    }
</style>

<div class="product-detail-container">

    <div class="" style="display: flex; gap: 5px; margin-left: 200px">
        <div class="thumbnail-list">
            @foreach (var img in allImages)
            {
                <img src="~/Images/@img" alt="Thumb" onclick="switchImage(this)" />
            }
        </div>

        <div class="product-image">
            <img id="mainProductImage" src="~/Images/@Model.ImageUrl" alt="@Model.ProductName" class="product-img" />
        </div>
    </div>

    <div class="product-info">
        <h1 style="font-size: 32px;">@Model.ProductName</h1>
        <p class="product-description" style="font-size: 16px; margin-top: 15px; font-style: italic">@Model.Description</p>
        <hr style="opacity:0.1" />
        <div class="product-price" style="font-size: 20px ;margin-top: 30px; margin-bottom: 20px; font-weight: bold">
            <span class="price">@Model.Price.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))</span>
        </div>

        <div class="product-colors">
            <label for="color" style="font-weight: 500; ">Màu Sắc</label>
            <select id="color" class="form-control">
                @foreach (var color in Model.AvailableColors)
                {
                    <option value="@color">@color</option>
                }
            </select>
        </div>

        <div style="display: flex; gap: 10px; font-weight: 500; margin-top: 15px">
            <p>Kích Thước</p>
            <a href="@Url.Action("ChonSize", "Home")" style=" color: black; font-weight: 400; font-size: 15px ">Hướng Dẫn Chọn Size</a>
        </div>

        <div class="product-options">
            <div class="product-sizes">
                <label for="size" style="font-weight: 500; ">Size</label>
                <select id="size" class="form-control">
                    @foreach (var size in Model.AvailableSizes)
                    {
                        <option value="@size">@size</option>
                    }
                </select>
            </div>
        </div>

        <!-- Số lượng -->
        <div class="quantity-section mb-3" style="display: flex; gap: 10px; align-items:center;">
            <p style="font-weight: 500; margin-top: 15px">Số Lượng</p>
            <div class="quantity-selector d-flex align-items-center">
                <button style="width: 30px; height: 30px; display:flex;justify-content: center; align-items: center;" type="button" class="btn btn-outline-secondary quantity-minus"><i class="fas fa-minus"></i></button>
                <input style="width: 100px; height: 30px;" type="number" asp-for="Quantity" class="form-control quantity-input text-center mx-2" min="1" max="100" value="1">
                <button style="width: 30px; height: 30px; display: flex; justify-content: center; align-items: center;" type="button" class="btn btn-outline-secondary quantity-plus"><i class="fas fa-plus"></i></button>
            </div>
        </div>
        <div class="action-buttons mt-4" style="display: flex; align-items: center; justify-content: center; gap: 40px; margin-bottom:10px;">
            <div class="add-to-cart">
                <button class="btn btn-add-to-cart" onclick="addToCart(@Model.ProductId)">
                    <i class="fas fa-shopping-cart"></i> Add To Cart
                </button>
            </div>

            <div class="add-to-cart">
                <a href="#" class="btn btn-order-now" onclick="orderNowLink()">
                    <i class="fas fa-bolt"></i> Đặt Hàng Ngay
                </a>
            </div>

            <div>
                <a href="@Url.Action("Index", "Home")" class="btn btn-continue">
                    <i class="fas fa-arrow-left"></i> Tiếp Tục Mua Sắm
                </a>
            </div>

        </div>

    </div>
</div>

@section Scripts {
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function switchImage(imgElement) {
            var mainImg = document.getElementById('mainProductImage');
            mainImg.src = imgElement.src;
        }

        $(document).ready(function () {
            $('.quantity-plus').click(function () {
                var input = $(this).siblings('.quantity-input');
                var value = parseInt(input.val());
                if (value < 100) {
                    input.val(value + 1);
                }
            });

            $('.quantity-minus').click(function () {
                var input = $(this).siblings('.quantity-input');
                var value = parseInt(input.val());
                if (value > 1) {
                    input.val(value - 1);
                }
            });

            $('.quantity-input').change(function () {
                var value = parseInt($(this).val());
                if (isNaN(value) || value < 1) {
                    $(this).val(1);
                } else if (value > 100) {
                    $(this).val(100);
                }
            });
        });

        function addToCart(productId) {
            // Lấy thông tin từ form
            var color = $('#color').val();
            var size = $('#size').val();
            var quantity = $('.quantity-input').val();

            // Kiểm tra số lượng hợp lệ
            if (quantity < 1 || quantity > 100) {
                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi',
                    text: 'Số lượng phải từ 1 đến 100'
                });
                return;
            }

            // Gửi AJAX request
            $.ajax({
                url: '@Url.Action("AddToCart", "Cart")',
                type: 'POST',
                data: {
                    productId: productId,
                    color: color,
                    size: size,
                    quantity: quantity
                },
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Thành công',
                            text: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        });

                        if (response.cartCount) {
                            $('#cart-count').text(response.cartCount);
                        }
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi',
                            text: response.message
                        });
                    }
                },
                error: function () {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi',
                        text: 'Có lỗi xảy ra khi thêm vào giỏ hàng'
                    });
                }
            });
        }

        function orderNowLink() {
    var color = $('#color').val();
    var size = $('#size').val();

    if (!color || !size) {
        Swal.fire({
            icon: 'warning',
            title: 'Thiếu thông tin',
            text: 'Vui lòng chọn đầy đủ màu sắc và kích thước'
        });
        return;
    }

    var productId = @Model.ProductId;

    $.ajax({
        url: '@Url.Action("GetProductVariantId", "Product")',
        type: 'POST',
        data: {
            productId: productId,
            color: color,
            size: size
        },
        success: function (response) {
            if (response.success) {
                var productVariantId = response.productVariantId;

                // 👉 Chuyển đến trang đặt hàng ngay
                window.location.href = '/Order/OrderNow?productVariantId=' + productVariantId;
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Không tìm thấy',
                    text: response.message
                });
            }
        },
        error: function () {
            Swal.fire({
                icon: 'error',
                title: 'Lỗi',
                text: 'Không thể lấy ProductVariantId'
            });
        }
    });
}


    </script>
}
